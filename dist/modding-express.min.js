const{isArray:a}=Array;var c=(function(){let A=this;return function(_){!game.custom.__MODDING_EXPRESS_DATA__&&(game.custom.__MODDING_EXPRESS_DATA__={loaders:new Map});let B=[];let{terminal:C,commands:d}=game.modding,{echo:E}=C;let f=function(_a){E(`[[bg;#fff;]&lsqb;ModdingExpress&rsqb; ${_a.replace(/\[/g,'&lsqb;').replace(/\]/g,'&rsqb;')}]`)};let g=function(D){E(`[[bg;orange;]&lsqb;ModdingExpress&rsqb; ${D.replace(/\[/g,'&lsqb;').replace(/\]/g,'&rsqb;')}]`)};let h=function(_A,_b,..._c){if('function'===typeof _A)try{_A.call(_b,..._c)}catch(aA){return{success:!1,error:aA}}return{success:!0}};let I=function(aB){return`${aB.name||'Unknown'} (v${aB.version||'1.0'}) by ${aB.author||'Unknown'}`};let j=game.custom.__MODDING_EXPRESS_DATA__;let k=function(aC,_B,_C=null){if(!aC){!_C?g(`Failed to resolve middleware from ${_C}: Received value is blank.`):g('Failed to resolve a blank middleware.');throw ''}let _d=h(aC.load,aC,_B);if(!_d.success){g(`Failed to run load script for middleware ${I(aC)}, caught error:`);g(_d.error?.stack||'');throw ''}B.push(aC);f(`Loaded module: ${I(aC)}`);return aC.exports};const l=function(aD){aD=aD.trim();try{new URL(aD)}catch(e){aD=`https://github.com/bhpsngum/starblast-modding-express/raw/main/middleware/${aD}/index.js`}return aD};return{load:function(aE,aF,aG=!1){if('string'!==typeof aE)return k(aE,aF);aE=l(aE);let _D=j.loaders.get(aE);if(!aG&&_D)return k(_D,aF,aE);let _e=new XMLHttpRequest;_e.open('GET',aE,!1);try{_e.send()}catch(e){g(`Failed to resolve URL ${aE}: Fetch failed.`);return{}}try{_D=Function('game',_e.responseText)(game)}catch(e){g(`Failed to resolve URL ${aE}: Error when evaluating code.`);g(e.stack);return{}}j.loaders.set(aE,_D);try{return k(_D,aF,aE)}catch(e){return{}}},initialize:function(){let aH=this;for(let aK of B){let aL=h(aK.initialize,aK,game);!aL.success&&(g(`Failed to run initialization script for middleware ${I(aK)}, caught error:`),g(aL.error?.stack||''));aK.options=aK.options||A.options;A.options={};if('object'===typeof aK.options)b(A.options,aK.options);else{let aM=h(aK.options,aK,A.options);!aM.success&&(g(`Failed to load options for middleware ${I(aK)}, caught error:`),g(aM.error?.stack||''))}if(a(aK.commands)){let i=0;for(let command of aK.commands){let aN=i++;if(!command)continue;if(!command.name){g(`Failed to load command index ${aN} in ${I(aK)}: Missing command name.`);continue}if('function'!==typeof command.handler){g(`Failed to load command '${command.name}' in ${I(aK)}: Missing command handler function.`);continue}d[command.name]=command.handler}}}mod.tick=mod.tick||A.tick;let aI=function(aO){for(let aP of B){let aQ=!1;let aR=h(aP.tick,A,aO,aP,function(){aQ=!0});!aR.success&&(g(`Failed to run tick script for middleware ${I(aP)}, caught error:`),g(aR.error?.stack||''));if(aQ)break}h(aH.tick,A,aO);for(let ship of aO.ships)for(let aS of B){let aT=!1;let aU=h(aS.playerTick,aS,ship,aO,aS,function(){aT=!0});!aU.success&&(g(`Failed to run player tick script for middleware ${I(aS)}, caught error:`),g(aU.error?.stack||''));if(aT)break}};A.tick=aV=>{aI(aV);A.tick!==aI&&(A.tick=aI)};mod.event=mod.event||A.event;let aJ=function(aW,aX){for(let aZ of B){let bA=!1;let bB=h(aZ.event,aZ,aW,aX,aZ,function(){bA=!0});!bB.success&&(g(`Failed to run event script for middleware ${I(aZ)}, caught error:`),g(bB.error?.stack||''));if(bA)break}h(aH.event,A,aW,aX);let aY=aW.killer||aW.ship;if(aY)for(let bC of B){let bD=!1;let bE=h(bC.playerEvent,A,aY,aW,aX,bC,function(){bD=!0});!bE.success&&(g(`Failed to run player event script for middleware ${I(bC)}, caught error:`),g(bE.error?.stack||''));if(bD)break}};A.event=(bF,bG)=>{aJ(bF,bG);A.event!==aJ&&(A.event=aJ)}}}}}).call(this),{assign:b}=Object;
